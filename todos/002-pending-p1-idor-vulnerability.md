---
status: pending
priority: p1
issue_id: "002"
tags:
  - code-review
  - security
  - authorization
dependencies:
  - "001"
---

# IDOR Vulnerability - No Authorization Check

## Problem Statement

The `/api/ad-accounts/:accountId/objects` endpoint validates UUID format but performs NO authorization check to verify if the requester has access to the specified account. Any authenticated user can access any account's data by guessing UUIDs.

## Findings

**Location:** `apps/api/src/routes/ad-accounts.ts:71-75`

```typescript
// Only checks if account EXISTS, not if user is AUTHORIZED
const account = await getAccountById(accountIdResult.data);
if (!account) {
  throw new NotFoundError('Account not found');
}
// NO AUTHORIZATION CHECK - any valid UUID returns data
```

**Security Impact:**
- Attackers can enumerate and access ANY ad account by iterating UUIDs
- Complete horizontal privilege escalation
- All customer financial data is exposed

## Proposed Solutions

### Option 1: Add User-Account Relationship (Recommended)
- **Pros:** Proper authorization model
- **Cons:** Requires database schema change
- **Effort:** Medium
- **Risk:** Low

### Option 2: Check Account Ownership via PlatformConnection
- **Pros:** Uses existing relationships
- **Cons:** Requires user-to-connection relationship
- **Effort:** Medium
- **Risk:** Low

## Recommended Action

After implementing authentication (001), add authorization middleware that verifies the user has access to the requested account before returning data.

## Technical Details

**Affected Files:**
- `apps/api/src/routes/ad-accounts.ts`
- New: `apps/api/src/middleware/authorize.ts`
- Potentially: `packages/database/src/schema/boris.ts` (add user_id to platform_connections)

## Acceptance Criteria

- [ ] Users can only access accounts they own
- [ ] Accessing another user's account returns 403 Forbidden
- [ ] Tests verify authorization is enforced

## Work Log

| Date | Action | Learnings |
|------|--------|-----------|
| 2025-12-28 | Identified in code review | PR #9 review |

## Resources

- PR #9: https://github.com/ijmorales/boris/pull/9
- OWASP IDOR: https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/05-Authorization_Testing/04-Testing_for_Insecure_Direct_Object_References
